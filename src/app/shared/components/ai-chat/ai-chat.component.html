<!-- Floating Action Button with Pulsing Ring -->
<div class="chat-fab-container" *ngIf="!isOpen">
    <button mat-fab class="chat-fab" (click)="toggleChat()">
        <svg class="fab-icon" viewBox="0 0 64 64" fill="none" xmlns="http://www.w3.org/2000/svg">
            <!-- Coffee Cup -->
            <path d="M18 42h28v4c0 2.2-1.8 4-4 4H22c-2.2 0-4-1.8-4-4v-4z" stroke="white" stroke-width="2.5"
                stroke-linecap="round" stroke-linejoin="round" />
            <rect x="16" y="26" width="32" height="16" rx="2" stroke="white" stroke-width="2.5" stroke-linecap="round"
                stroke-linejoin="round" />
            <path d="M48 30h2c2.2 0 4 1.8 4 4s-1.8 4-4 4h-2" stroke="white" stroke-width="2.5" stroke-linecap="round"
                stroke-linejoin="round" />
            <!-- AI Neural Network Steam -->
            <circle cx="24" cy="16" r="2" fill="white" />
            <circle cx="32" cy="12" r="2" fill="white" />
            <circle cx="40" cy="16" r="2" fill="white" />
            <circle cx="28" cy="20" r="1.5" fill="white" />
            <circle cx="36" cy="20" r="1.5" fill="white" />
            <line x1="24" y1="16" x2="28" y2="20" stroke="white" stroke-width="1.5" />
            <line x1="32" y1="12" x2="28" y2="20" stroke="white" stroke-width="1.5" />
            <line x1="32" y1="12" x2="36" y2="20" stroke="white" stroke-width="1.5" />
            <line x1="40" y1="16" x2="36" y2="20" stroke="white" stroke-width="1.5" />
            <line x1="28" y1="20" x2="32" y2="24" stroke="white" stroke-width="1.5" />
            <line x1="36" y1="20" x2="32" y2="24" stroke="white" stroke-width="1.5" />
        </svg>
    </button>
</div>

<!-- Chat Window -->
<div class="chat-window" *ngIf="isOpen">
    <div class="chat-header">
        <h3>
            <svg class="chat-header-icon" viewBox="0 0 64 64" fill="none" xmlns="http://www.w3.org/2000/svg">
                <!-- Coffee Cup -->
                <path d="M18 42h28v4c0 2.2-1.8 4-4 4H22c-2.2 0-4-1.8-4-4v-4z" stroke="white" stroke-width="2.5"
                    stroke-linecap="round" stroke-linejoin="round" />
                <rect x="16" y="26" width="32" height="16" rx="2" stroke="white" stroke-width="2.5"
                    stroke-linecap="round" stroke-linejoin="round" />
                <path d="M48 30h2c2.2 0 4 1.8 4 4s-1.8 4-4 4h-2" stroke="white" stroke-width="2.5"
                    stroke-linecap="round" stroke-linejoin="round" />
                <!-- AI Neural Network Steam -->
                <circle cx="24" cy="16" r="2" fill="white" />
                <circle cx="32" cy="12" r="2" fill="white" />
                <circle cx="40" cy="16" r="2" fill="white" />
                <circle cx="28" cy="20" r="1.5" fill="white" />
                <circle cx="36" cy="20" r="1.5" fill="white" />
                <line x1="24" y1="16" x2="28" y2="20" stroke="white" stroke-width="1.5" />
                <line x1="32" y1="12" x2="28" y2="20" stroke="white" stroke-width="1.5" />
                <line x1="32" y1="12" x2="36" y2="20" stroke="white" stroke-width="1.5" />
                <line x1="40" y1="16" x2="36" y2="20" stroke="white" stroke-width="1.5" />
                <line x1="28" y1="20" x2="32" y2="24" stroke="white" stroke-width="1.5" />
                <line x1="36" y1="20" x2="32" y2="24" stroke="white" stroke-width="1.5" />
            </svg>
            Assistant Caribou
        </h3>
        <button mat-icon-button (click)="toggleChat()">
            <mat-icon style="color: white;">close</mat-icon>
        </button>
    </div>

    <div class="chat-messages" #messagesContainer>
        <div *ngFor="let msg of messages" class="message" [class.user]="msg.sender === 'user'"
            [class.bot]="msg.sender === 'bot'">
            <div class="message-avatar">
                <mat-icon style="font-size: 20px; width: 20px; height: 20px;">
                    {{ msg.sender === 'user' ? 'person' : 'smart_toy' }}
                </mat-icon>
            </div>
            <div class="message-bubble">{{ msg.text }}</div>
        </div>

        <div class="message bot" *ngIf="isTyping">
            <div class="message-avatar">
                <mat-icon style="font-size: 20px; width: 20px; height: 20px;">smart_toy</mat-icon>
            </div>
            <div class="typing-indicator">
                <div class="typing-dot"></div>
                <div class="typing-dot"></div>
                <div class="typing-dot"></div>
            </div>
        </div>
    </div>

    <div class="chat-input-container">
        <input type="text" placeholder="Posez votre question..." [(ngModel)]="userInput" (keyup.enter)="sendMessage()"
            #inputField>
        <button mat-icon-button class="send-btn" (click)="sendMessage()" [disabled]="!userInput.trim()">
            <mat-icon>send</mat-icon>
        </button>
    </div>
</div>